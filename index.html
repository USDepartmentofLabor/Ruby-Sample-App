<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML> 
<HEAD> 
<TITLE>U.S. Department of Labor -- The Department of Labor Developer Community</TITLE>
<META NAME="keywords" CONTENT="Department of Labor, DOL, Secretary of Labor" />
<!-- begin dol-styles.shtm -->
<link rel="shortcut icon" href="http://www.dol.gov/favicon.ico" type="image/x-icon">
<link rel="icon" href="http://www.dol.gov/favicon.ico" type="image/x-icon">
<link href="http://www.dol.gov/dol.css" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="http://developer.dol.gov/api.css" TYPE="text/css" />
<link href="http://webapps.dol.gov/FSPublic/Content/W_Helpful.css" rel="stylesheet" type="text/css">
<style type="text/css">
<!--
caption {text-align:left; font-size:80%}
table{margin-left:12px;}


-->
</style>

<!-- end dol-styles.shtm -->
		<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.min.js"></script>
<script type="text/javascript" src="prettify.js"></script>
<script language="JavaScript" type="text/javascript">

	jQuery(document).ready(function(){

		// This line of code makes code pretty to look at and understand.
		window.prettyPrint && prettyPrint()
	
	});
	


</script>
<!--start include header-dest-redesign3.shtm -->
<script src="http://webapps.dol.gov/FSPublic/Scripts/W_Helpful.js" type="text/javascript"></script>
<script type="text/javascript">
		$(document).ready(function() {
			W_Helpful.init('#fbcontent');
		});
</script> 
</HEAD> 
<BODY> 
<div id="Main">
	<!--Header Start -->
    <a href="#pagecontent" class="skipster">Skip to page content</a>

<div id="Header">
    <div id="Banner">
        <p class="banner"><a href="http://www.dol.gov">United States Department of Labor</a></p>
    </div>
		<div id="RightColumn"><table><tr><td valign="bottom">
		
			</td><td>
            
  
 
 
 
            
            
          </td></tr>
		  <tr><td colspan="2">
			

			</td></tr></table>
		</div>
	</div>
    
	<!--Header End -->

	<!--Body Start -->
	<div id="Body">
		<div id="UtilityBar" class="tools">
			<div class="utilitybarleft"><div id="agencyname">&nbsp;</div></div>

			<!-- This is where the E-mail This page use to be -->
			<div class="utilitybarright">
				<div id="fbcontent" style="float:right"></div>			
			</div>
		</div>
		<div class="crumb-links"><!-- begin crumb-nonav-auto.shtm -->
<TABLE BORDER="0" CELLSPACING="0" CELLPADDING="0">
  <TR>
    <TD VALIGN="middle" ALIGN="LEFT" height="7" style="padding-left:2px"><span class="crumb-links">
      <a href="http://www.dol.gov">DOL Home</a> &gt; <a href="http://www.dol.gov/open/">OPEN</a> &gt; <a href="http://developer.dol.gov">Developer Community</a> &gt; Ruby DOL Data SDK Sample
      </span> </td>

  </tr>
</table>
<!-- end crumb-nonav-auto.shtm --></div>
		<div id="content" >
			<div id="pagecontent" style="width:768px;font-size:0;line-height:0;"></div>

<!--end include header-dest-redesign3.shtm -->
<!-- START CONTENT HERE  *************************************************** -->
<h1>Ruby Government Data SDK Sample</h1>

<h2>Overview</h2>
<p>
This sample will provide the steps to create a simple Ruby application that can consume GOV Data. 
Following these steps in order will allow your application to operate correctly.  
<a href="/Samples/opa.DolData.SDK.Example.Ruby.zip">Download this project</a> | 
<a href="/Samples/opa.DolData.SDK.V2.Example.Ruby.zip">Download project for Service Operation.</a>
<br>
</p>
<p>This solution was built using:</p>
<ul>
<li>
<a href="http://www.ruby-lang.org/en">Ruby</a>
</li>
</ul>
<br>

<h2>Create a New Project</h2>
<p>
Create a project folder for this sample.<br><br>
Create a new text document using any text editor and save it as <strong>GOVDataExample.rb</strong> in the project folder.<br>
<br>
</p>
<br>

<h2>Add SDK to Project</h2>
<p>
Copy the SDK file into the project folder.  You can get this from one this <a href="https://github.com/USDepartmentofLabor/Ruby_DOLDataSDK">GitHub Repository</a>.</p>
<p>
Ensure that you have installed the <strong>
<a href="http://rubygems.org/gems/json">json</a></strong> 
and <strong><a href="http://rubygems.org/gems/ruby-hmac">ruby-hmac</a></strong> gems.<br><br>

<pre class="prettyprint">MACHINE:~ user$ gem install json
MACHINE:~ user$ gem install ruby-hmac</pre><br>
</p>


<h2>Locate the Dataset Path</h2>
<p>
Each Dataset has a Dataset Location path that gives the URL that will be needed to reach the Dataset on the API. For this sample please see the one circled in red (http://api.dol.gov/V1/DOLAgency).<br><br>
<img alt="Add Service Reference" src="images/DataSetLocation.png" WIDTH="60%"  /><br><br>

For the DOL Service Operation sample please use http://api.dol.gov/V1/SummerJobs<br><br>

<br>


</p>
<br>

<h2>Implementing the Government Data Request</h2>
<p>

<h3><a name="Federal"></a>Using This SDK With APIs From Other Federal Agencies</h3>
<p>This sample project uses DOL's API.  Some federal APIs' URLs are structured differently.  For example, let's look at http://business.usa.gov/api/article/xml
<ul>
	<li>API_LOGIN = ""</li>
    <li>API_KEY = ""</li>
	<li>SHARED_SECRET = ""</li>
	<li>API_HOST = "http://business.usa.gov"</li>
	<li>API_URI = "/api"</li>
	<li>API_DATA = "/article/xml"</li>
</ul></p>

<p>Alternatively, let's look at the Census Bureau, which uses an API key.  For example, http://api.census.gov/data/2010/acs5?key={your key}&get=B02001_001E,NAME&for=state:06,36
<ul>
    <li>API_LOGIN = ""</li>
	<li>API_KEY = "key={your key}"</li>
	<li>API_SECRET = ""</li>
	<li>API_Host = "http://api.census.gov"</li>
	<li>API_URI = "/data"</li>
	<li>API_DATA = "/2010/sf1"</li>
</ul></p>
<br>
<br>
The <strong><a href="https://github.com/USDepartmentofLabor/Ruby_DOLDataSDK">GOVDataSDK.rb</a></strong> file handles everything required for submitting data requests to the Department of Labor and external Government Entity API. We will need the SDK classes in that file so we add them to <strong>GOVDataExample.rb</strong> with a require statement.<br>
<br>

<pre class="prettyprint">require './GOVDataSDK'</pre><br></p>

<p>In order to submit data requests, we will need to create two objects; an instance of <strong>GOV::DataContext</strong>, to hold various information about our data request, and an instance of <strong>GOV::DataRequest</strong>, to handle the submission of the request.<br> 
The API_HOST,API_KEY,APISECRET, API_DATA and API_URI constants work for all government entities if an option is not used in your government entity class call simply leave it blank and only use the required variables for that government entity.<br> 
When calling the department of labor use the call_api and for all external government entities use the call_ext_api method call<br>
<br>

<pre class="prettyprint">
#If one of the constants below does not have a value for the government entity you are calling simply leave it blank or empty. 
API_HOST = 'http://api.dol.gov'
API_KEY = 'your-token'
API_SECRET = 'your-shared-secret'
API_DATA = 'DOLAgency/Agencies'
API_URI = 'V1'
context = GOV::DataContext.new API_HOST, API_KEY, API_SECRET, API_LOGIN, API_DATA, API_URI
request = GOV::DataRequest.new context
</pre><br></p>

<h2>Configure Security</h2>
<p>
Secure logins are provided using the following code; we will need to insure that the <strong>GOV::DataContext</strong> instance is initialied with both an <strong>ApiKey</strong> and a <strong>SharedSecret</strong>.  Replace "your-token" and "your-shared-secret" in <strong>GOV::DataContext.new</strong> with your Token and SharedSecret.<br>
<ul>
<li>The <strong>ApiKey</strong> corresponds to the <strong>Token</strong> identifier in your token list.</li>
<li>The <strong>SharedSecret</strong> that is associated with that token.</li>
</ul>
</p>

<p>Next, we need to call the method<strong>GOV::DataRequest#call_api</strong> on the newly created <strong>GOV::DataRequest</strong> instance.  This method submits the request to the API.  The method argument represents the Dataset and table portion of the Data location path.  The arguments argument represents additional information sent to the API to narrow down the data you wish to recieve.<br>
<br>
For Standard DOL API datasets <br /><br />
<pre class="prettyprint">request.call_api API_DATA, :select => ‘Agency,AgencyFullName’, :orderby => ‘AgencyFullName’</pre><br></p>

<p>For DOL Service Operation (e.g. Summer Job Plus), we will change the value of API_DATA to 'SummerJobs/getJobsListing.' <br /><br />
<pre class="prettyprint">#Each String type parameter must be surrounded in quotes in order to work correctly.
#These quotes are tehn Url encoded and passed to the Service Operation.
#Each parameter that is assigned null should be left blank
request.call_api API_DATA,	:format => '\'json\'', :query => '\'farm\'', 
						:region => '', :locality => '', 
						:skipcount => '1' do |results, error|</pre><br><br></p>

<p>Additionally, we need to provide <strong>#call_api</strong> with a block to execute after the DOL API returns the data we requested.<br>
<br>

For Standard DOL API datasets <br /><br />
<pre class="prettyprint">request.call_api API_DATA, :select => ‘Agency,AgencyFullName’, :orderby => ‘AgencyFullName’ do |results, error|
	#if the JSON is parsed
    results.each do |n|
      puts "#{n['Agency']} - #{n['AgencyFullName']}"
    end
    #end if the JSON is parsed
    
    #if the JSON is not parsed
    print results
    #end if the JSON is not parsed
end</pre><br></p>

<p>For DOL Service Operation (e.g. Summer Job Plus)<br />
<pre class="prettyprint">#Each String type parameter must be surrounded in quotes in order to work correctly.
#These quotes are tehn Url encoded and passed to the Service Operation.
#Each parameter that is assigned null should be left blank
request.call_api 'SummerJobs/getJobsListing',	:format => '\'json\'', :query => '\'farm\'', 
						:region => '', :locality => '', 
						:skipcount => '1' do |results, error|
						
	if error
		puts error
	else
	
		Jobs = results['getJobsListing']
		JobsListing = Jobs['items']
		# results
		JobsListing.each do |n|
			puts "#{n['title']} - #{n['snippet']}"
		end
		
	end
end</pre><br></p>


<p>Finally, we need to tell Ruby to wait until the request finishes before closing.  We do this by calling <strong>GOV::DataRequest#wait_until_finished</strong> on the <strong>GOV::DataRequest</strong> instance.<br>
<br>
<pre class="prettyprint">request.wait_until_finished</pre><br></p>

<p>The finished code should look like this:<br><br>
For Standard DOL API datasets :<br><br>
<pre class="prettyprint">#import the GOVDataSDK file into your sample project.
require './GOVDataSDK'

#Create a new object and call the extend data set.

API_HOST = 'http://api.dol.gov'
API_KEY = ''
API_SECRET = ''
API_DATA = 'DOLAgency/Agencies'
API_URI = 'V1'

context = GOV::DataContext.new API_HOST, API_KEY, API_SECRET, API_DATA, API_URI
request = GOV::DataRequest.new context

substitute the method and arguments as necessary.
request.call_api API_DATA, :select => 'Agency,AgencyFullName', :orderby => 'AgencyFullName' do |results, error|
  if error
   puts error
  else
  print "\nattempting to print the results\n"
	#if the JSON is parsed
    results.each do |n|
      puts "#{n['Agency']} - #{n['AgencyFullName']}"
    end
    #end if the JSON is parsed
    
    #if the JSON is not parsed
    print results
    #end if the JSON is not parsed
  end
end

request.wait_until_finished</pre><br></p>


<p>For DOL Service Operation (e.g. Summer Job Plus) :<br><br>
<pre class="prettyprint">#import the GOVDataSDK file into your sample project.
require './GOVDataSDK'

#Create a new object and call the extend data set.

API_HOST = 'http://api.dol.gov'
API_KEY = ''
API_SECRET = ''
API_DATA = 'SummerJobs/getJobsListing'
API_URI = 'V1'

context = GOV::DataContext.new API_HOST, API_KEY, API_SECRET, API_DATA, API_URI
request = GOV::DataRequest.new context


#Make API call
request.call_api API_DATA, :format => '\'json\'', :query => '\'farm\'', 
           :region => '', :locality => '', 
            :skipcount => '1' do |results, error|
            
  if error
    puts error
  else
  
    Jobs = results['getJobsListing']
    JobsListing = Jobs['items']
     results
    JobsListing.each do |n|
      puts "#{n['title']} - #{n['snippet']}"
    end
    
  end
end



request.wait_until_finished</pre><br>
</p>



<h2>Run the Application</h2>
<p>
In order to run this application you will need to open a terminal window and navigate into your project folder.<br><br>

<img alt="Enter Project Folder" src="images/Terminal.png" /><br><br>

Run the program with <strong>ruby GOVDataExample.rb</strong> and you should see a list of Agencies printed to the terminal.<br><br>
For Standard DOL API datasets :<br><br>
<img alt="Run the appliation to see a list of Agencies printed to the terminal" src="images/Data.png" /><br><br>
For DOL Service Operation (e.g. Summer Job Plus) :<br><br>
<img alt="Run the appliation to see a list of jobs printed to the terminal" src="images/summer_job_result.png" /><br><br>
</p>

<!-- END CONTENT HERE  *************************************************** -->
<!---original location of this file: "/includes/" -->

</div><!--Body End -->

 </div>

	<!--Footer Start -->
	<div id="Footer">
		<div id="FooterMenu">
			<div id="FooterMenuContainer">
				<a href="http://www.dol.gov/dol/foia/main.htm">Freedom of Information Act</a>&nbsp;|&nbsp;

				<a href="http://www.dol.gov/dol/privacynotice.htm">Privacy & Security Statement</a>&nbsp;|&nbsp;
				<a href="http://www.dol.gov/dol/disclaim.htm">Disclaimers</a>&nbsp;|&nbsp;
				<a href="http://webapps.dol.gov/feedback/FeedbackSurvey.aspx">Customer Survey</a>&nbsp;|&nbsp;
				<a href="http://www.dol.gov/dol/aboutdol/website-policies.htm">Important Web Site Notices</a>&nbsp;|&nbsp;

                <a href="http://www.dol.gov/dol/aboutdol/plug-ins.htm">Plug-ins Used by DOL</a>
			</div>
		</div>
	
		<div id="FooterContact">
			<div id="FooterContactContainer">
				U.S. Department of Labor&nbsp;|&nbsp;Frances Perkins Building, 200 Constitution Ave., NW, Washington, DC 20210<br>

				<a href="http://www.dol.gov" style=" text-decoration: underline; ">www.dol.gov</a>&nbsp;|&nbsp;Telephone: 1-866-4-USA-DOL (1-866-487-2365)&nbsp;|&nbsp;TTY: 1-877-889-5627&nbsp;|&nbsp;<u><a href="http://www.dol.gov/dol/contact/index.htm">Contact Us</a></u>
			</div>
		</div>
	</div>
	<!--Footer End -->


</div><!--Main End -->

  </BODY>
</HTML>
